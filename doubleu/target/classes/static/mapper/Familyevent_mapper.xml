<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.doubleu.notice.mybatis.FamilyeventMapper">
	<insert id="insert" parameterType="com.doubleu.notice.vo.FamilyeventVo">
		insert all
		into FAMILYEVENT(
			familyeventNo, 
			familyeventSubject, 
			familyeventMid, 
			familyeventReportingDate, 
			familyeventType, 
			familyeventHit, 
			familyeventDoc 
			)
		values(
			seq_familyeventNo.nextval, 
			#{familyeventSubject}, 
			#{familyeventMid}, 
			SYSDATE, 
			#{familyeventType}, 
			#{familyeventHit}, 
			#{familyeventDoc} 
			)
		<if test="attList != null">
			<foreach collection="attList" item="att">
				into familyevent_files(
					files_no, 
					familyevent_no, 
					file_sysfile, 
					file_orifile
				)
				values(
					seq_files_no.nextval,
					seq_familyeventNo.currval,
					#{att.sysFile, jdbcType=VARCHAR},
					#{att.oriFile, jdbcType=VARCHAR}
				)
			</foreach>
		</if>	
		SELECT * FROM dual
	</insert>
	
	<select id="select" resultType="com.doubleu.notice.vo.FamilyeventVo">
		<![CDATA[
			select familyeventNo, 
				   familyeventSubject, 
				   familyeventMid, 
				   to_char(familyeventreportingdate, 'YYYY-MM-DD') as familyeventreportingdate, 
				   familyeventType, 
				   familyeventHit, 
				   familyeventDoc 
			from FAMILYEVENT 
			order by familyeventNo desc 
		]]>
	</select>
	
	<select id="view" parameterType="Int" resultType="com.doubleu.notice.vo.FamilyeventVo">
		<![CDATA[
			select familyeventNo, 
				   familyeventSubject, 
				   familyeventMid, 
				   to_char(familyeventreportingdate, 'YYYY-MM-DD') as familyeventreportingdate, 
				   familyeventType, 
				   familyeventHit, 
				   familyeventDoc 
			from FAMILYEVENT
			where familyeventNo = #{_parameter}
		]]>
	</select>
	
 	<select id="view1" parameterType="int" resultMap="attList">
		<![CDATA[
			select files_no, 
				   familyevent_no, 
				   file_sysfile, 
				   file_orifile 
			from familyevent_files
			where familyevent_no = #{_parameter}
		]]>
	</select>
	
	
	<update id="update" parameterType="com.doubleu.notice.vo.FamilyeventVo" >
		<![CDATA[
			update FAMILYEVENT
			set
				familyeventSubject = #{familyeventSubject}, 
				familyeventReportingdate = #{familyeventReportingDate}, 
				familyeventType = #{familyeventType}, 
				familyeventDoc = #{familyeventDoc} 
			where familyeventNo = #{familyeventNo} 
		]]>
	</update>
	
	<select id="delete" parameterType="int">
		<![CDATA[
			delete from FAMILYEVENT where familyeventNo = #{_parameter}
		]]>
	</select>

	<resultMap id="attList" type="com.doubleu.notice.vo.FamilyeventAttVo">
		<result property="filesNo" column="files_no"/>
		<result property="familyeventNo" column="familyevent_no"/>
		<result property="sysFile" column="file_sysfile"/>
		<result property="oriFile" column="file_orifile"/>
	</resultMap>
	
</mapper>

		